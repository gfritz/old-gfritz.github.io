
<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="Ramblings by a developer">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Garth Blog</title>
    <link rel="shortcut icon" href='http://localhost:8080/favicon.png'>
    <link rel="alternate" type="application/rss+xml" title="RSS" href='http://localhost:8080/blog/rss.xml' />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href='http://localhost:8080/css/FSharp.Formatting/styles/style.css'>
    <link rel="stylesheet" href='http://localhost:8080/css/firm.css'>
    <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <script>window.html5 || document.write('<script src="js/vendor/html5shiv.js"><\/script>')</script>
    <![endif]-->
</head>
<body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href='http://localhost:8080/'>Garth Blog</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class=""><a href='http://localhost:8080/blog/about'>About</a></li>
                    <li class=""><a href='http://localhost:8080/blog/archive'>Archive</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div id="topsection" class="jumbotron">
        <div class="container">
            <h1><a href='http://localhost:8080/'>Garth Blog</a></h1>
            <p>Stuff I figure out</p>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div id="main-panel" class="col-md-8">
                


<div class="post">
    <h1 class="post-title">Clearing Entity Fields in Early Bound Plugin Code</h1>
    <small>2017-02-22 20:11:04Z</small>
    <div class="post-content"><p>If you try to NULL the value of an Entity field and save that change with the CRM OrganizationServiceContext, you need to be careful how you set that NULL value.  If the field to NULL is not in the <code>myEntity.Attributes</code> collection, then it will not be updated when the service call updates the record in CRM.</p>

<p>We can demonstrate this by initializing the early bound Account entity in a few different ways and inspecting the Attribute collection.  The field to clear in this example will be <code>ParentAccountId</code>.</p>

<p>First, we will use the constructor then NULL with dot notation.<br />
Second, we use the object initializer syntax and null with that.
Third, we initialize only the ID field and use dot notation to set the field NULL.</p>

<p>These attempts will not put ParentAcountId into the Attributes collection.  Two ways that will work are setting the field to NULL with the late bound class, and initializing or setting ParentAccountId with a dummy non-NULL value in the early bound class then setting the field to NULL.</p>

<p>This test class will demonstrate each of these approaches.</p>

<script src="https://gist.github.com/gfritz/bf68281d1326bcc2afe0.js"></script>

<p>In this case, using the late bound entity is more straightforward than using the early bound entity.  With late bound you will not get intellisense so make sure you have the correct spelling and casing for your field.  You can find the correct string to use in your early bound entities file by hitting F12 on the early bound field and inspecting the method decorator.  For our field, we use the string in here: <code>[Microsoft.Xrm.Sdk.AttributeLogicalNameAttribute("parentaccountid")]</code>.</p>

<p>If you use the <a href="https://github.com/daryllabar/DLaB.Xrm.XrmToolBoxTools/releases">Early Bound Generator tool</a> from the <a href="http://www.xrmtoolbox.com/">XRM Toolbox</a>, one particularly useful thing it does is enumerates each attribute name as a struct of strings.  That provides intellisense and the correctly cased string name of the field.</p>

<p>Initializing an early bound entity field with NULL looks like code that should work, but chances are you only notice the problem when the update does not clear that field in CRM.  You could just as easily do <code>earlyBoundAccount["parentaccountid"] = null;</code>, but why would that be your first choice when you have early bound classes?</p>

<p>You might consider a wrapper class to handle this NULL setting logic for you, or probably simpler still an extension method <code>SetToNull(myAccount, "nameOfFieldToClear")</code> so you can use this for all entities.  Remember to use the <code>Fields</code> struct if you use the Early Bound Generator to create your early bound classes - <code>SetToNull(myAccount, Account.Fields.NameOfFieldToClear)</code>.</p>


</div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'garth-blog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

            </div>
            <div id="right-panel" class="col-md-4">
                <div id="tag-cloud">
                        <a class="tag tag-unselected" data-postcount="5" href='http://localhost:8080/blog/archive?tag=blog'>blog</a>
                </div>
                <div id="latest-posts">
                    <h3>Latest posts</h3>
                        <h4>
                            <a href='http://localhost:8080/blog/post/clearing-entity-fields-in-early-bound-plugin-code/'>Clearing Entity Fields in Early Bound Plugin Code</a>
                            <br/>
                            <small>2017-02-22 20:11:04Z</small>
                        </h4>
                        <h4>
                            <a href='http://localhost:8080/blog/post/crm-2016-deactivate-record-bug-and-workaround/'>CRM 2016 Deactivate Record on Form With Emtpy Required Fields Bug and Workaround</a>
                            <br/>
                            <small>2016-08-22 14:02:51Z</small>
                        </h4>
                        <h4>
                            <a href='http://localhost:8080/blog/post/crm-2016-set-static-values-using-default-relationship-mappings/'>CRM 2016 Set Non-Mapped Values in Relationship Mappings</a>
                            <br/>
                            <small>2016-08-19 15:14:05Z</small>
                        </h4>
                        <h4>
                            <a href='http://localhost:8080/blog/post/asp-net-5-rc1-and-net-core-are-go-live/'>ASP.NET 5 RC1 and .NET Core Are &quot;Go Live&quot;</a>
                            <br/>
                            <small>2015-11-24 04:07:37Z</small>
                        </h4>
                        <h4>
                            <a href='http://localhost:8080/blog/post/welcome-to-ghost/'>Welcome to Ghost</a>
                            <br/>
                            <small>2015-11-24 02:44:45Z</small>
                        </h4>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div class="row">
            <div class="col-md-4">
                <p>This site is generated with <a href="https://github.com/andagr/Firm">Firm</a> and hosted on <a href="https://gfritz.github.io">Github</a>.</p>
            </div>
        </div>
    </footer>
    
    <a href="https://github.com/andagr/Firm">
        <img style="position: absolute; top: 50px; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
    </a>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script type="text/javascript" src='http://localhost:8080/js/ie10-viewport-bug-workaround.js'></script>
    <script type="text/javascript" src='http://localhost:8080/js/FSharp.Formatting/tips.js'></script>
    <script type="text/javascript" src='http://localhost:8080/js/netext.js'></script>
</body>
</html>